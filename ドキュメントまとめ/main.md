# Verse 言語まとめ

2023.10.21 Cyross

## はじめに

## 参考文献

- [UEFN ドキュメント](https://dev.epicgames.com/documentation/ja-jp/uefn/unreal-editor-for-fortnite-documentation)
- [Verse 言語ファレンス](https://dev.epicgames.com/documentation/ja-jp/uefn/verse-language-reference)
- [Verse API リファレンス(英語)](https://dev.epicgames.com/documentation/ja-jp/uefn/verse-api)

## Verse の主な設計目標

[言語リファレンス](https://dev.epicgames.com/documentation/ja-jp/uefn/verse-language-reference)より抜粋

- シンプル
  - プログラミング初心者でも習得できる。
- 汎用的
  - どのような種類のコードやデータも記述できる。
- 高い生産性
  - チーム作業におけるプロジェクトのビルド、イテレート、シッピング、およびコードとコンテンツの統合。
- 静的に検証
  - コンパイル時にできるだけ多くの種類のランタイムの問題を見つけられるようにする。
- 高いパフォーマンス
  - リアルタイム、オープン ワールド、およびマルチプレイヤー ゲームの作成。
- 完全
  - 言語のすべての機能でプログラマーによるその機能の抽象化をサポート。
- 長期的に使用可能
  - 他の言語の過去のアーティファクトに根差すことなく、現在のニーズと近い将来のニーズに対応する設計。

## Verse の特徴

[言語リファレンス](https://dev.epicgames.com/documentation/ja-jp/uefn/verse-language-reference)より抜粋

- 強い型付け
  - 開発または展開時にエラーが特定されない事態を最小限に抑えるとともに、静的チェックをサポートします。
- マルチパラダイム
  - 可能な限り決定論的になるようにするなど、関数型プログラミング、オブジェクト指向プログラミング、および命令型プログラミングの長所を活かします。その例としては、データがデフォルトで不変となっており、コードとデータが同じであれば、結果は常にまったく同じになるといったことが挙げられます。
  - (追記)[決定論とは、あらゆる出来事は、その出来事に先行する出来事のみによって決定している、とする哲学的な立場。](https://ja.wikipedia.org/wiki/%E6%B1%BA%E5%AE%9A%E8%AB%96)
  - (追記)つまり、参照透明とミューテーブルが言語仕様レベルで保証されているということ
- 文と式の区別がない
  - Verse ではすべてが式(関数)であるため、すべてで結果が得られます。
  - (追記)つまり、if ブロックも式なので、ブロックを評価した結果(成功した場合)が返ってくる
- 失敗は制御フロー
  - Verse では、(判定ポイントなどで) プログラムのフローを変更するために true/false 値を使用するのではなく、成功した場合に値を生成し、失敗した場合には値を生成しない「失敗する可能性がある式」を使用します。失敗する可能性がある式は、if 式などの失敗コンテキストでのみ実行できます。
  - (追記)単純なフロー制御ではないのがわかる
  - (追記)失敗する可能性がある式は必須ではない。単純な結果を返す式も作れる(例: `if ... else ...`)
  - (追記)例外処理はどうなる？
- 失敗コンテキスト内での投機的実行が可能
  - アクションをコミットすることなく試行できます。式が成功すると、その式のエフェクトはコミットされますが、式が失敗した場合、その式のエフェクトは式が評価されなかったかのようにロールバックされます。このようにして、次々と変更が加えられる一連のアクションを実行できますが、失敗コンテキストで失敗が起きると、そうしたアクションは元に戻されます。
  - (追記)要は遅延評価を採用している？
  - (追記)式のエフェクトとは？
- 言語レベルでの並列処理
  - アクションを同時に実行するために複数のプロセッサのシステムレベルのスレッドに頼る必要がありません。言語で組み込みの並列処理式を使用することにより、制御フローと同じようにタイムフローを作成できます。

## Verse の特に重要な単語

### action (アクション)

- 実行するもの
  - 関数
  - 数学演算
- アクションのロールバックは、関数や演算した内容に生成や更新があった場合、アクションを起こす前に巻き戻すことができる

### context (コンテキスト)

- 言語のさまざまな要素とコンストレイントのライフタイムを定義するコードのスコープ
  - 通常、コードブロックの開始から終了までの範囲

### effect (エフェクト)

- 関数で示すことができる動作のカテゴリ

以下の例では、関数 が「`IsCriticalHealth`」と命名され、`Health` パラメータ で入力として `float` 値 を取得することがコードで述べられています。次に、関数が示すエフェクトが `decides` と `transacts` であること、つまり関数が 失敗コンテキスト であり、失敗した場合はそのアクションを ロールバック できることが述べられています。関数に入力として渡される `Health` 値が 0.0 より大きく、30.0 以下の場合、関数は成功します。それ以外の場合は関数が失敗し、その関数を呼び出したコンテキストで失敗を処理する必要があります。

```Verse
IsCriticalHealth(Health : float)<decides><transacts> : void = ((Health > 0.0) && (Health <= 30.0))
```

- 詳細は、「指定子と属性」を参照
